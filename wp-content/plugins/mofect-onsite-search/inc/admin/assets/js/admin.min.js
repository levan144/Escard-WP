var DEVICE_TYPE_IPHONE="iPhone",DEVICE_TYPE_ANDROID="Android",DEVICE_TYPE_IPAD="iPad",DEVICE_OTHERS="others",KEYWORDS_ITEMS=20,RECENT_KEYWORD_ITEMS=50,POPULAR_KEYWORD_ITEMS=50;function MossAdmin(a){this.adminData=a,this.g_trackData=[],this.g_keyword_chart_handler=void 0,this.keywordsChartData={labels:[],data:[]},this.popularKeywordsData=[],this.userLocationsData=[],this.deviceChartData={labels:[DEVICE_TYPE_IPHONE,DEVICE_TYPE_ANDROID,DEVICE_TYPE_IPAD,DEVICE_OTHERS],data:[0,0,0,0]},MossAdmin.prototype.init=function(){var a=this;jQuery.ajax({url:a.adminData.ajax_url,type:"GET",data:{action:"moss_get_tracking_data"},success:function(t){a.g_trackData=JSON.parse(t.data),a.g_trackData&&Array.isArray(a.g_trackData)&&(a.g_trackData.sort(function(a,t){return a.data?t.data?t.data.length-a.data.length:-1:1}),a.initGlobalChartsData(),a.renderPopularKeywordChart(),a.renderDeviceChart(),a.renderUserLocationMappingEchart())}})},MossAdmin.prototype.initGlobalChartsData=function(){for(var a=1;a<=this.g_trackData.length;a++){var t=this.g_trackData[a-1],e=t.keyword,r=t.data;a<=KEYWORDS_ITEMS&&(this.keywordsChartData.labels.push(e),r?this.keywordsChartData.data.push(r.length):this.keywordsChartData.data.push(0)),a<=POPULAR_KEYWORD_ITEMS&&this.popularKeywordsData.push(t);for(var s=0;s<r.length;s++){var i=r[s];if(i.device)switch(i.device.toUpperCase){case DEVICE_TYPE_IPHONE.toUpperCase():this.deviceChartData.data[0]=this.deviceChartData.data[0]+1;break;case DEVICE_TYPE_ANDROID.toUpperCase():this.deviceChartData.data[1]=this.deviceChartData.data[1]+1;break;case DEVICE_TYPE_IPAD.toUpperCase():this.deviceChartData.data[2]=this.deviceChartData.data[2]+1;break;default:this.deviceChartData.data[3]=this.deviceChartData.data[3]+1}else this.deviceChartData.data[3]=this.deviceChartData.data[3]+1;if(i.country){var o=this.userLocationsData.findIndex(function(a){return i.country==a.name});o>=0?this.userLocationsData[o].value=this.userLocationsData[o].value+1:this.userLocationsData.push({name:i.country,value:1})}}}},MossAdmin.prototype.renderPopularKeywordChart=function(){var a=this;this.popularKeywordsData.length<=0?jQuery("#popular-keywords-table").append('<div class="keywords-table-no-items">'+this.adminData.no_records_message+"</div>"):this.popularKeywordsData.forEach(function(t){var e=t.keyword,r=t.data,s=!1;r&&r.forEach(function(a){return"TRUE"==a.status.toUpperCase()?s=!0:""}),jQuery("#popular-keywords-table").append('<ul class="table"><li class="td">'+e+'</li><li class="td">'+(s?"Success":"No result")+'</li><li class="td">'+(r?r.length:0)+'</li><li class="td action"><a href="'+a.adminData.edit_post_url+"?post="+t.post_id+'&action=edit">View Detail</a></li></ul>')})},MossAdmin.prototype.renderRecentKeywordsChart=function(){var a=this;jQuery.ajax({url:a.adminData.ajax_url,type:"GET",data:{action:"moss_get_recent_tracking_data"},success:function(t){if(t.data){var e=JSON.parse(t.data);if(e&&0!=e.length)for(var r=1;r<=e.length;r++){var s=e[r-1],i=s.keyword,o=s.data;if(r<=RECENT_KEYWORD_ITEMS){var d=!1;o&&o.forEach(function(a){return a.status?d=!0:""}),jQuery("#recent-keywords-table").append('<ul class="table"><li class="td">'+i+'</li><li class="td">'+(d?"Success":"No result")+'</li><li class="td">'+(o?o.length:0)+'</li><li class="td action"><a href="'+a.adminData.edit_post_url+"?post="+s.post_id+'&action=edit">View Detail</a></li></ul>')}}else jQuery("#recent-keywords-table").append('<div class="keywords-table-no-items">'+a.adminData.no_records_message+"</div>")}else jQuery("#recent-keywords-table").append('<div class="keywords-table-no-items">'+a.adminData.no_records_message+"</div>")}})},MossAdmin.prototype.renderDeviceChart=function(){var a=document.getElementById("device-chart");if(a){var t=a.getContext("2d");new Chart(t,{type:"pie",data:{datasets:[{data:this.deviceChartData.data,backgroundColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],label:"Dataset 1"}],labels:this.deviceChartData.labels},options:{responsive:!0}})}},MossAdmin.prototype.renderUserLocationMappingEchart=function(){var a=document.getElementById("location-echart");if(a){var t=echarts.init(a,"",{height:300}),e={title:{text:"Accessed users regions.",subtext:"",sublink:"https://mofect.com/mofect-on-site-search",left:"center",top:"top"},tooltip:{trigger:"item",formatter:function(a){return a.value?a.name+'<br/> <div style="text-align: center">'+a.value+" times</div>":'<div style="text-align: center">0 times</div>'}},toolbox:{show:!0,showTitle:!0,orient:"vertical",left:"right",top:"center",feature:{dataView:{readOnly:!0,title:"Data view",lang:["Data view","Turn off","refresh"]},restore:{title:"restore"},saveAsImage:{type:"png",name:"region",title:"save as image"}}},visualMap:{min:0,max:1e6,text:["High","Low"],realtime:!1,calculable:!0,inRange:{color:["lightskyblue","yellow","orangered"]}},series:[{name:"current region",type:"map",mapType:"world",roam:!0,itemStyle:{emphasis:{label:{show:!0}}},data:this.userLocationsData}]};t.setOption(e,!0)}},MossAdmin.prototype.updateKeywordChartByDuration=function(){jQuery(".keyword-statistics-filter").click(function(a){jQuery(".keyword-statistics-filter").removeClass("active"),jQuery(this).addClass("active");var t={action:a.currentTarget.dataset.ajaxAction};jQuery.ajax({url:mofect_admin_data.ajax_url,type:"GET",data:t,success:function(a){console.log(a);var t=a.data;if(t&&(t.sort(function(a,t){return a.data?t.data?t.data.length-a.data.length:-1:1}),keywordsChartData.labels=[],keywordsChartData.data=[],g_keyword_chart_handler)){for(var e=0;e<t.length;e++){var r=t[e],s=r.keyword,i=r.data;e<=KEYWORDS_ITEMS&&(keywordsChartData.labels.push(s),i?keywordsChartData.data.push(i.length):keywordsChartData.data.push(0))}g_keyword_chart_handler.destroy();var o=document.getElementById("keywords-chart").getContext("2d");g_keyword_chart_handler=new Chart(o,{type:"bar",data:{labels:keywordsChartData.labels,datasets:[{label:"search times",data:keywordsChartData.data,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}}})})},MossAdmin.prototype.renderKeywordChart=function(){var a=document.getElementById("keywords-chart");if(a){var t=a.getContext("2d");this.g_keyword_chart_handler=new Chart(t,{type:"bar",data:{labels:this.keywordsChartData.labels,datasets:[{label:"search times",data:this.keywordsChartData.data,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}}}if(jQuery(".mofect-admin-page").length){var gMossAdmin=new MossAdmin(mofect_admin_data);gMossAdmin.init(),gMossAdmin.renderRecentKeywordsChart()}